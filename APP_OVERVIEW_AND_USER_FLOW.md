# Vocare App — What It Does & User Flow

Use this as a reference to see everything the app does and how users move through it. Tell me what you want to change based on this.

---

## What the app is

**Vocare** is a React Native (Expo) mobile app that helps students discover purpose through small acts of service. It uses AI to connect personal “energy drivers” with campus needs and generates daily **Micro-Missions** (under ~20 minutes). It’s inspired by Jesuit values and the Buechner quote: *“The place God calls you to is the place where your deep gladness and the world’s deep hunger meet.”*

---

## Tech at a glance

- **Auth & profile:** Supabase (email/password); profile and onboarding stored in Supabase.
- **Missions:** Generated by OpenAI; stored locally (AsyncStorage) — not yet in Supabase.
- **Community needs:** Stored in Supabase (`hunger_feed`); missions can be generated from these needs.
- **Navigation:** Expo Router (file-based). Root layout has an **AuthGate** that redirects by auth + onboarding state.

---

## User flow (step by step)

### 1. App entry

- **Route:** `app/index.tsx` (splash).
- **Behavior:** Shows “Vocare / Discover Your Purpose” and a loading indicator while auth loads.
- **Routing:** `_layout.tsx` **AuthGate** decides where to send the user (see below). User does not “land” on index for long.

---

### 2. Authentication

**If not signed in** → user is sent to **Login**.

- **Route:** `(auth)/login.tsx`
- **UI:** Vocare branding, email and password fields, “Begin the Journey” button, link to “Create Account”.
- **Actions:** Sign in with Supabase; on success, AuthGate sends to onboarding (if profile not onboarded) or to main app `(tabs)`.

**Sign up**

- **Route:** `(auth)/signup.tsx`
- **UI:** “Create Account” header, full name + email + password (min 6 chars), “Create Account” button, link to Sign In.
- **Actions:** Supabase sign up; then `updateDisplayName(name)` is called so the profile has a display name. User is then sent to onboarding (welcome) because `onboardingComplete` is still false.

**AuthGate logic (in root `_layout.tsx`):**

- No user → replace to `/(auth)/login`.
- User exists but `profile.onboardingComplete` is false → replace to `/(onboarding)/welcome`.
- User exists and onboarding complete → replace to `/(tabs)` (main app).

---

### 3. Onboarding (first time only)

**Welcome**

- **Route:** `(onboarding)/welcome.tsx`
- **UI:** Dark gradient screen, “Build Better Habits / Through Purpose & Service”, short description of Vocare, three bullets (discover energy drivers, AI micro-missions, grow your Purpose Tree), “Get Started” button.
- **Action:** Tapping “Get Started” goes to `/(onboarding)/gladness`.

**Gladness (energy drivers)**

- **Route:** `(onboarding)/gladness.tsx`
- **UI:** “What Gives You Energy?” — multi-select chips from a fixed list (e.g. Creating Beauty, Deep Listening, Building Systems, Organizing Chaos, Solving Puzzles, Connecting People, Physical Activity, Teaching & Mentoring). Must select **at least 2**. “Discover My Path” at bottom.
- **Actions:** Saves selected drivers to profile via `updateGladnessDrivers(selected)`, then `completeOnboarding()`, then `router.replace("/(tabs)")` so user enters the main app.

---

### 4. Main app (tab bar)

After onboarding, the user lives in the **tab layout**: **Home**, **Growth**, **Report**. A custom **BottomTabBar** (blur style) shows: Home (house), Growth (tree), Report (hand-heart). Settings are not in the tab bar; they’re reached from Home.

---

### 5. Home tab

- **Route:** `(tabs)/index.tsx`

**Header**

- Time-based greeting (Good Morning / Afternoon / Evening) + display name (from profile or “Pilgrim”).
- Settings icon (top right) → navigates to ` /settings`.

**Active / pending mission**

- If there is a `currentMission` with status `active` or `pending`, a card is shown: “Mission In Progress” or “Mission Waiting”, mission title, chevron.
- Tapping it: if status is `pending` → `/mission/reveal`; if `active` → `/mission/active`.

**Daily check-in (mood)**

- Card: “How is your spirit today?” with four mood options: **Anxious**, **Bored**, **Energized**, **Content** (from `MOODS`).
- User picks one → `generateMission(mood, profile.gladnessDrivers)` is called (uses OpenAI + optional hunger feed needs), then router pushes to `/mission/reveal`.
- While generating, a “Crafting your mission...” loading state is shown.

**Community Needs**

- Section “Community Needs”: list of up to 5 needs from `fetchHungerFeedWithMeta(user?.id)` (Supabase). Each item shows description, location, category, submitter name, and acceptance count (e.g. “2 of 3 accepted”).
- Tapping a need → `/need/[id]`.
- If loading: spinner. If error or empty: message (e.g. “No needs yet — submit one from the Report tab.”).

**Your Journey (quick stats)**

- Two small cards: “Active Mission” count (1 or 0), “Completed” count (from `missionHistory` where status === `completed`).

---

### 6. Mission flow (reveal → active → reflection)

**Reveal**

- **Route:** `mission/reveal.tsx`
- **When:** User just got a mission from Home (mood selected) or resumed a pending mission from Home.
- **UI:** Dark gradient, “Your Mission / A Call Has Arrived”, mission shown in a “parchment” ScrollCard (title, description, location, time).
- **Actions:**
  - “ACCEPT THE CALL” → `acceptMission()`, then replace to `/mission/active`.
  - “Save to discern later” → `skipMission()`, then replace to `/(tabs)` (mission goes to history as skipped).

**Active**

- **Route:** `mission/active.tsx`
- **UI:** “In Progress” badge, mission title, “Accepted just now”, location, estimated minutes, “Mission Impact” (description), Buechner quote card, bottom button “Complete Mission”.
- **Action:** “Complete Mission” → `completeMission()`, then replace to `/mission/reflection`.

**Reflection**

- **Route:** `mission/reflection.tsx`
- **UI:** “Did doing this make you feel alive?” with two big options: **YES** (Consolation) and **NO** (Desolation), plus “Skip Reflection”.
- **Actions:**
  - YES → `recordReflection(true)` then replace to `/(tabs)`.
  - NO → `recordReflection(false)` then replace to `/(tabs)`.
  - Skip → `recordReflection(false)` then replace to `/(tabs)`.
- Mission is then in `missionHistory` with `status: "completed"` and `feltAlive` set; `currentMission` is cleared.

---

### 7. Growth tab (Purpose Tree)

- **Route:** `(tabs)/growth.tsx`
- **UI:** “Growth Tree” / “Watch your purpose take root”. A **GrowthTree** component shows completed missions as leaves; green = felt alive (Consolation), brown = desolation. Tapping a leaf opens a modal with that mission’s title, description, location, and felt-alive vs desolation.
- **Stats row:** Counts for Consolations, Desolations, Total (completed missions).
- **Legend:** Green leaf = “Felt Alive”, other leaf = “Desolation”.

Data source: `missionHistory` from `MissionContext` (filtered to `status === "completed"`).

---

### 8. Report tab (submit a need)

- **Route:** `(tabs)/report.tsx`
- **UI:** Buechner quote at top. “Submit a Need” header and short description. Form:
  - **What’s the need?** — multiline text (max 300 chars), character count.
  - **Location** — text field (e.g. “O’Neill Library”).
  - **Category** — chips: Service, Organization, Support.
  - **How many people do you need?** — number input or “As many as possible” checkbox.
- **Action:** “Offer this Need” inserts into Supabase `hunger_feed` (user_id, description, location, category, people_needed, creator_display_name). Form resets and an alert thanks the user.

---

### 9. Need detail (from Home or direct)

- **Route:** `need/[id].tsx`
- **UI:** Back button, then need description, location, category, “Submitted by …”, acceptance count. If current user is the creator: “Your need” badge and “Mark as filled” (if status is open). If not creator: “Accept this need” or “You’ve accepted this need” + “Undo acceptance”.
- **Actions:** Accept / Undo accept / Mark as filled; all update Supabase and refresh the need.

---

### 10. Settings

- **Route:** `settings.tsx` (reached from Home’s gear icon).
- **UI:** Back button, “Settings” title, card with profile display name, email, and energy drivers (gladness chips), then “Sign Out” button.
- **Action:** Sign out confirmation alert; on confirm, `signOut()` and AuthGate sends user back to login.

---

## Data summary

| What              | Where        | Notes                                      |
|-------------------|-------------|--------------------------------------------|
| Auth              | Supabase    | Email/password                              |
| User profile      | Supabase    | display_name, gladnessDrivers, onboardingComplete |
| Missions          | AsyncStorage| currentMission + missionHistory (local only) |
| Hunger feed (needs)| Supabase   | hunger_feed table; acceptances, status      |
| Mission generation| OpenAI API  | Uses mood + gladness drivers + hunger feed |

---

## Constants that shape the experience

- **Moods (Home check-in):** Anxious, Bored, Energized, Content.
- **Gladness drivers (onboarding):** Creating Beauty, Deep Listening, Building Systems, Organizing Chaos, Solving Puzzles, Connecting People, Physical Activity, Teaching & Mentoring.
- **Need categories (Report):** Service, Organization, Support.

---

## Screen list (for quick reference)

| Screen        | Route / Group     | Purpose                          |
|---------------|-------------------|----------------------------------|
| Splash        | `/`               | Entry while auth loads           |
| Login         | `(auth)/login`     | Sign in                          |
| Sign up       | `(auth)/signup`    | Create account                   |
| Welcome       | `(onboarding)/welcome` | First-time intro            |
| Gladness      | `(onboarding)/gladness` | Pick energy drivers (2+)   |
| Home          | `(tabs)/index`     | Check-in, mission card, needs, stats |
| Growth        | `(tabs)/growth`    | Tree + completed missions        |
| Report        | `(tabs)/report`    | Submit a need                    |
| Mission Reveal| `mission/reveal`   | See mission, accept or skip      |
| Mission Active| `mission/active`   | Do mission, mark complete        |
| Reflection    | `mission/reflection` | Did it make you feel alive?   |
| Need detail   | `need/[id]`        | View/accept/mark filled         |
| Settings      | `settings`         | Profile, drivers, sign out      |

---

You can now tell me what you’d like to change (e.g. flow, copy, new screens, data, or behavior), and we can implement it step by step.
